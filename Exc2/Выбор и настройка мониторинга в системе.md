### Мотивация

Внедрение мониторинга позволит:

- Быстро выявлять узкие места и сбои в системе, что позволит впоследствии провести необходимый рефакторинг и снизить жалобы операторов и клиентов.

- Уменьшить количество просроченных заказов за счёт контроля задержек и загрузки системы.

- Выявить закономерности / явления, которые были не очевидны при ручном наблюдении лишь за жалобами пользователей. Это позволит увидеть более полную картину
для более продуманного принятия решений.

### Выбор подхода к мониторингу

- Для сервисов, основанных на запросах, идеально подойдет RED (Rate, Errors, Duration). В нашем случае это API (Shop API, CRM API, MES API).
Можно отслеживать количество запросов (Rate), количество ошибок (Errors) и время ответа (Duration), чтобы выявить проблемы с производительностью API.

- Для MES и баз данных хорошо подойдет USE (Utilization, Saturation, Errors), так как он лучше всего работает с ресурсами, 
производительность которых снижается при интенсивном использовании (серверы, бд и инструменты). В нашем случае как раз есть 
инструмент, производительность которого тем ниже, чем больше его используют, а также два инстанса базы. Мониторинг позволит выявить, есть ли необходимость
скейлить ресурсы для этих частей системы.

- Для мониторинга RabbitMQ лучше всего подойдет подход RED. Он идеален для систем, которые обрабатывают сообщения или запросы, 
таких как очереди сообщений, где важно отслеживать количество сообщений, ошибки и время обработки.

### Выбранные метрики и их описание

`Number of dead-letter-exchange letters in RabbitMQ`

Зачем: Позволяет отслеживать количество сообщений, которые не удалось обработать.

Ярлыки: Источник сообщения (MES, CRM), причина отказа.

`Number of messages in flight in RabbitMQ`

Зачем: Позволяет видеть задержки в очередях.

Ярлыки: Очередь, тип сообщения.

`Response time (latency) for shop API`   
`Response time (latency) for CRM API`  
`Response time (latency) for MES API`  

Зачем: Позволяет оценить задержки на всем пути заказа.

Ярлыки: Тип запроса, источник запроса.

`CPU % for MES API`

Зачем: Позволяет отслеживать перегрузку системы при росте количества заказов.

Ярлыки: Узел сервиса, время суток.

`Memory Utilisation for shop db instance`  
`Memory Utilisation for MES db instance`

Зачем: Контроль за перегрузкой базы данных.

Ярлыки: Тип нагрузки (чтение/запись), запрос.

`Number of requests (RPS) per user for internet shop API`  
`Number of requests (RPS) per user for CRM API`  
`Number of requests (RPS) per user for MES API`  

Зачем: Позволяет следить за нагрузкой и пиковыми моментами, выявлять аномальную активность.

Ярлыки: Источник запроса, идентификатор пользователя / запроса.

`Number of HTTP 500 for MES API`  
`Number of HTTP 500 for shop API`  
`Number of HTTP 500 for CRM API`  

Зачем: Контроль за критическими ошибками сервисов.

Ярлыки: Тип запроса, причина ошибки.

`Size of S3 storage`

Зачем: Позволит оценить нагрузку, заметить превышение лимитов и снизить траты на облачное хранилище

Ярлыки: Время загрузки, id объекта в бакете

### План действий

1. Развернуть time-series базу данных для хранения метрик, например, Prometheus или InfluxDB.

2. Настроить сбор метрик с использованием exporters для RabbitMQ, MES, CRM и интернет-магазина.

3. Настроить визуализацию данных в Grafana с дашбордами по критическим метрикам.

4. Настроить алерты на основе метрик.

5. Добавить мониторинг состояния базы данных MES (нагрузка, соединения, потребление памяти).

6. Настроить мониторинг нагрузки серверов (CPU, память).

7. Интегрировать мониторинг с системой уведомлений (Telegram, e-mail) для оперативного реагирования.